pile-integration
================

The project consists of boiler-plate code to help in testing
executables that generate output using stderr and stdout.
It is a very simple way of running executables and 
writing test code against the textual output.

Upon the completion of a run the test code is able to
examine the output of the program through stderr, stdout 
and combined. Exit code can also be tested.

The project depends on Qt (version 5.4 was tested)
and on the CMake scripts from
[pile-cmake](https://github.com/pile-contributors/pile-cmake)
project.

To add it to your project clone the
[pile-cmake](https://github.com/pile-contributors/pile-cmake)
repository:

    git clone https://github.com/pile-contributors/pile-cmake.git

Then, inside your project's `test` directories:

    git submodule add https://github.com/pile-contributors/pile-integration.git

Add following lines inside CMakeLines.txt for `test` directory:

    list(APPEND CMAKE_MODULE_PATH
        "${CMAKE_CURRENT_SOURCE_DIR}/pile-integration")
    include("pile-integration")

    pileIntegrationAddExes (
        "myapp"
    )

    pileIntegrationTest ("MyAppTest"
        test_help.cc)

A simple test (say `test_help.cc`) looks like so:

    #include "integration.h"

    INTEST(help)
    {
        INTEST_EXEC(EXE_NAME_MYAPP, "help");
    }
    ENDINTEST(help)

This will run once the executable called `myapp`
with one argument: `help`.


How it works
============

`pileIntegrationAddExes()` macro simply add the name of one
or more executables to a config file generated by CMake.
This allows us to control the name of the executable(s)
to be tested from the CMake file.

`pileIntegrationTest()` macro will create an executable
called `MyAppTest` out of the source code from
pile-integration and the files provided as argument
(`test_help.cc` in this case). The test (`MyAppTest`) executable
will run all the tests and it will exit with the number of
failed tests (thus 0 means success).

`INTEST` and `ENDINTEST` pair actually create a class
arround the code and a static instance of that class
afterwards. The argument that you provide will be part of the
name of that class, so the names must be unique.

This class inherits `intest::Integration` that adds each instance
as it is constructed to a list inside `intest::Manager`.
All the instances in the list are then executed to run
the tests.
